<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' id='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'/>
		<meta charset='UTF-8'/>
		<title>Japanese Kanji Readings</title>
		<script type='text/javascript' src='js/underscore-min.js'></script>
	</head>
	<body>
		<div><input type='text' id='kanji_search' placeholder='Loading...' disabled='disabled'/></div>
		<div id='show_result'>
		</div>
	</body>
	<script type='text/template' id='show_result_template'>
<% for (var i = 0; i < data.length; i++) { %>
	<% var kanjiData = data[i];%>
	<h3><%-kanjiData.kanji%></h3>
	<table>
		<% if (kanjiData.on) { %>
			<tr><td>On Reading:</td><td><%-kanjiData.on.join(', ')%></td></tr>
		<% } %>
		<% if (kanjiData.kun) { %>
			<tr><td>Kun Reading:</td><td><%-kanjiData.kun.join(', ')%></td></tr>
		<% } %>
	</table>
<% } %>
	</script>
	<script>
'use strict'
var kanjiData = null;
function getKanjiReading(text) {
	if ('string' !== typeof text) {
		return undefined;
	}
	var dupCharChecker = {};
	var result = [];
	for (var i = 0; i < text.length; i++) {
		var kanji = text.charAt(i);
		var kanjiCode = text.charCodeAt(i).toString(16).toUpperCase();
		var kanjiReading = _.clone(kanjiData[kanjiCode]);
		if (kanjiReading && !dupCharChecker[kanji]) {
			dupCharChecker[kanji] = true;
			kanjiReading['kanji'] = kanji;
			result.push(kanjiReading);
		}
	}
	return result;
}

var kanji_search = document.getElementById('kanji_search');
var show_result = document.getElementById('show_result');
var displayKanjiReading = _.template(document.getElementById('show_result_template').innerHTML);

kanji_search.addEventListener('input', _.throttle(function(e){
	show_result.innerHTML = displayKanjiReading({data:getKanjiReading(document.getElementById('kanji_search').value)});
}, 100));

var xhr=new XMLHttpRequest();
xhr.addEventListener('readystatechange', function(){
	if (this.readyState == 4 && this.status == 200) {
		kanjiData = JSON.parse(this.responseText);
		kanji_search.removeAttribute('disabled');
		kanji_search.setAttribute('placeholder', 'Input Kanji');
	}
});
xhr.open('GET', 'readings.json');
xhr.send();
	</script>
</html>

